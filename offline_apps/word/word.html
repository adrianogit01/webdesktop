<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Editor Word-Like</title>
    <script src="tinymce.min.js"></script>
    <script src="FileSaver.min.js"></script>
    <style>
      html, body {
        margin: 0;
        padding: 0;
        height: 100%;
      }
      textarea {
        height: 100vh;
      }
      #custom-buttons {
        display: flex;
        gap: 10px;
        padding: 10px;
        flex-wrap: wrap;
        background: #f2f2f2;
      }
      #custom-buttons button {
        padding: 6px 12px;
        font-size: 14px;
        cursor: pointer;
      }
      @media (max-width: 600px) {
        #custom-buttons {
          flex-direction: column;
        }
        #custom-buttons button {
          width: 100%;
        }
      }
    </style>
  </head>
  <body>
    <div id="custom-buttons">
      <button onclick="saveContent('html')">ðŸ’¾ Salvar .html</button>
      <button onclick="saveContent('txt')">ðŸ’¾ Salvar .txt</button>
      <button onclick="saveContent('docx')">ðŸ’¾ Salvar .docx</button>
      <input type="file" accept=".html,.txt" onchange="loadFile(event)" />
    </div>

    <textarea id="editor"></textarea>

    <script>
      const EDITOR_KEY = "tinymce-autosave";

      // FunÃ§Ã£o para salvar o conteÃºdo
      function saveContent(type) {
        const content = tinymce.get("editor").getContent({ format: type === 'txt' ? 'text' : 'html' });
        const blob = new Blob([content], { type: type === "txt" ? "text/plain" : "text/html;charset=utf-8" });
        const filename = `documento.${type}`;
        saveAs(blob, filename);
      }

      // Carregar arquivos locais
      function loadFile(event) {
        const file = event.target.files[0];
        const reader = new FileReader();
        reader.onload = function (e) {
          const content = e.target.result;
          tinymce.get("editor").setContent(content);
        };
        reader.readAsText(file);
      }

      // Verifica modo escuro do sistema
      const useDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches;

      // Inicia o editor
      tinymce.init({
        selector: "#editor",
        height: "800",
        plugins: "autosave image link table lists code fullscreen",
        toolbar: "undo redo | bold italic underline | alignleft aligncenter alignright | bullist numlist | code fullscreen",
        menubar: false,
        skin: useDarkMode ? "oxide-dark" : "oxide",
        content_css: useDarkMode ? "dark" : "default",
        setup: function (editor) {
          // Salva no localStorage sempre que houver alteraÃ§Ã£o
          editor.on("Change KeyUp", () => {
            localStorage.setItem(EDITOR_KEY, editor.getContent());
          });

          // Restaura o conteÃºdo salvo anteriormente
          editor.on("init", () => {
            const saved = localStorage.getItem(EDITOR_KEY);
            if (saved) editor.setContent(saved);
          });
        },
      });
    </script>
  </body>
</html>

